{% extends 'layout.twig' %}
{# ----------------------------------------------------------------------- #}
{% block content %}
    {# {{ include('inc/code-select.twig') }} #}
    <div class="row" id="edit">
        <div class="col-12 col-md h3">
            {{ desc }}
        </div>
        {% if code and not cloned %}
            <div class="col-12 col-md text-md-center col-lg h4 mt-md-1">
                {{ code }}
            </div>
        {% endif %}
        {% if code and nav.count > 0 %}
            <div class="col-12 col-md text-md-right mt-md-2">
                ({{ t.NumberOfMany(nav.pos, nav.count) }})
            </div>
        {% endif %}
    </div>
    <div class="row mb-3">
        <div
            class="col text-muted text-center">
            {# Supress other hints if there is a specific code set hint #}
            {% if code_set_hint %}
                <div class="h5">{{ code_set_hint }}</div>
                {% elseif code_admin.param %}
                {{ t.ParameterSetHint }} {% elseif code_admin.slave %}
                {{ t.SlaveSetHint }}
            {% endif %}
        </div>
    </div>
    {% if code and not cloned and nav.count > 1 %}
        {% set link_next = pathFor('edit', { 'set': set, 'code': nav.next, 'lang': lang, 'lang2': lang2 }) %}
        <div class="row mb-3">
            <div class="col btn-group" role="group">
                <a href="{{ pathFor('edit', { set: set, code: nav.first, lang: lang, lang2: lang2 }) }}#edit" class="btn btn-outline-secondary form-control d-none d-md-block">
                    <i class="fa fa-fw fa-angle-double-left"></i>
                    {{ nav.first }}
                </a>
                {% if nav.count > 2 %}
                    <a href="{{ pathFor('edit', { set: set, code: nav.prev, lang: lang, lang2: lang2 }) }}#edit" class="btn btn-outline-secondary form-control">
                        <i class="fa fa-fw fa-angle-left"></i>
                        {{ nav.prev }}
                    </a>
                    <a class="btn btn-outline-secondary form-control" href="{{ link_next }}#edit">
                        {{ nav.next }}
                        <i class="fa fa-fw fa-angle-right"></i>
                    </a>
                {% endif %}
                <a href="{{ pathFor('edit', { set: set, code: nav.last, lang: lang, lang2: lang2 }) }}#edit" class="btn btn-outline-secondary form-control d-none d-md-block">
                    {{ nav.last }}
                    <i class="fa fa-fw fa-angle-double-right"></i>
                </a>
            </div>
        </div>
    {% endif %}
    <form action="{{ pathFor('POST edit') }}" method="post">
        {{ macros.input_hidden('set', set) }} {{ macros.input_hidden('lang', lang) }}
        {{ macros.input_hidden('lang2', lang2) }}
        {{ macros.input_hidden('code_old', code) }}
            {{ macros.input_hidden('next', link_next ?? '') }}
        <div class="form-row">
            <label class="col-md-3 text-bold col-form-label float-left" for="input-code">{{ t.Code }}</label>
            <div class="col form-group">
                {% set max = (set == 'code_set') ? 16 : 50 %}
                {% if code and not cloned and can.edit %}
                    <button id="btn-rename" class="btn btn-link text-danger" style="position:absolute; right:0; top:.25rem" data-toggle="tooltip" title="{{ t.h('RenameCode') }}">
                        <i class="fa fa-fw fa-pencil"></i>
                    </button>
                {% endif %}
                <input id="input-code" type="text" class="{{ code and not cloned ? 'form-control-plaintext font-weight-bold' : 'form-control' }}" name="code" maxlength="{{ max }}" value="{{ code }}" required="required" {{ code and not cloned ? 'readonly' }}/>
                {% if code == '' or cloned %}
                    <small class="form-text">{{ t.CodeMaxChars(max) }}</small>
                {% endif %}
            </div>
        </div>
        {% if set == 'code_set' %}
            {% if code starts with 'code_' %}
                {{ macros.input_hidden('admin[param]', admin.param) }}
                {{ macros.input_hidden('admin[slave]', admin.slave) }}
                {{ macros.input_hidden('admin[multi]', admin.multi) }} {% else %}
                {{ macros.input_admin_radio('', true, t.NormalSet) }}
                {{ macros.input_admin_radio('param', admin.param, t.ParameterSet, t.ParameterSetHint) }}
                {{ macros.input_admin_radio('slave', admin.slave, t.SlaveSet, t.SlaveSetHint) }}
                {{ macros.input_admin_checkbox('multi', admin.multi, t.MultilineSet, t.MultilineSetHint) }}
            {% endif %}
            {% else %}
            {% if can.edit %}
                {% if not code_admin.param %}
                    {# Parameters are always active #}
                    {{ macros.input_checkbox('active', 1 - active, t.Deprecated, t.DeprecatedHint) }}
                    {{ macros.input_checkbox('var', var, t.Placeholder, t.PlaceholderHint) }}
                {% endif %}
                {% if multi %}
                    {{ macros.input_checkbox('quantity', quantity, t.WithQuantity, t.WithQuantityHint) }}
                {% endif %}
                {% else %}
                {{ macros.input_hidden('active', active ? 1) }}
                    {{ macros.input_hidden('quantity', quantity ? 0) }}
                {% if not active or quantity %}
                    <div class="form-row">
                        <div class="col offset-md-3 form-group form-control-plaintext">
                            {% if not active %}
                                {{ t.DeprecatedHint }} <br/>
                            {% endif %}
                            {% if quantity %}
                                {{ t.WithQuantityHint }}
                            {% endif %}
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        {% endif %}
        {% if not can.edit or code starts with 'code_' or code_admin.param %}
            {{ macros.input_hidden('order', order) }} {% else %}
            <div class="form-row">
                <label class="col-md-3 col-form-label" for="input-order">{{ t.CodeOrder }}</label>
                <div class="col form-group">
                    {% if can.edit %}
                        <div class="input-group spinner" data-trigger="spinner">
                            <div class="input-group-prepend">
                                <div class="input-group-text px-1">
                                    <button class="btn btn-link btn-sm text-body" data-spin="down">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                </div>
                            </div>
                            <input id="input-order" class="form-control" type="text" data-rule="defaults" name="order" value="{{ order }}" pattern="-?[0-9]*"/>
                            <div class="input-group-append">
                                <span class="input-group-text px-1">
                                    <button class="btn btn-link btn-sm text-body" data-spin="up">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </span>
                            </div>
                        </div>
                        {% else %}
                        <div class="form-control-plaintext">
                            {{ order }}
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}
        {% if ( code_admin.param or not can.edit ) and hint %}
            {# Show hint for param sets only if is set #}
            <div class="form-row">
                <div class="col offset-md-3 form-group form-control-plaintext">
                    {{ hint }}
                </div>
            </div>
        {% endif %}
        {# Language rows ------------------------------------------------- #}
        {% for row in lang_rows %}
            {% if row.code == native and code_admin.slave %}
                {{ macros.input_hidden("desc[#{row.code}]", row.desc) }} {% else %}
                <div class="form-row {{ can.edit ? 'border-top pt-3' }}">
                    <label class="col-md-3 col-form-label">
                        {% if code_admin.param %}
                            {{ code_admin.desc }} {% else %}
                            {{ row.name }}
                        {% endif %}
                    </label>
                    <div class="col form-group">
                        {% if row.code == native and not can.edit %}
                            {# Change native only from can.edit upwards #}
                            {{ macros.input_hidden("desc[#{row.code}]", row.desc) }}
                            <p class="form-control-plaintext">{{ row.desc|e|nl2br }}</p>
                            {% else %}
                            {% if multi %}
                                <textarea class="form-control" name="desc[{{ row.code }}]" rows="5">{{ row.desc|e }}</textarea>
                                {% else %}
                                <input class="form-control" type="text" name="desc[{{ row.code }}]" value="{{ row.desc|e }}"/>
                            {% endif %}
                            {% if row.code != native and can.translate %}
                                <div class="form-text">
                                    <button data-lang="{{ native }}" data-lang2="{{ row.code }}" data-toggle="translate" data-target="gt" class="btn btn-sm">
                                        <i class="fa fa-fw fa-google"></i>
                                        Google Translate
                                    </button>
                                    <button data-lang="{{ native }}" data-lang2="{{ row.code }}" data-toggle="translate" data-target="dt" class="btn btn-sm">
                                        <i class="fa fa-fw fa-globe"></i>
                                        DeepL translator
                                    </button>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% if can.edit %}
                    <div class="form-row">
                        <label class="col-md-3 col-form-label">{{ t.Hint }}</label>
                        <div class="col form-group">
                            <input class="form-control" type="text" name="hint[{{ row.code }}]" value="{{ row.hint }}"/>
                        </div>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
        <div class="form-row">
            <div class="col-lg-3"></div>
            {% if can.translate %}
                <div class="col-12 col-md mb-2 mb-lg-0">
                    <button class="btn btn-block btn-primary" type="submit">
                        <i class="fa fa-fw fa-floppy-o"></i>
                        {{ t.Save }}
                    </button>
                </div>
            {% endif %}
            {% if can.translate and nav.count > 1 %}
                <div class="col-12 col-md mb-2 mb-lg-0">
                    <button class="btn btn-block btn-primary" name="go-next" type="submit">
                        <i class="fa fa-fw fa-floppy-o"></i>
                        {{ t.SaveAndNext }}
                    </button>
                </div>
            {% endif %}
            {% if nav.count > 1 %}
                <div class="col-12 col-md mb-2 mb-lg-0">
                    <a class="btn btn-block btn-secondary" href="{{ link_next }}#edit">
                        {{ t.Next }}
                        <i class="fa fa-fw fa-angle-right"></i>
                    </a>
                </div>
            {% endif %}
        </div>
    </form>
{% endblock %}
